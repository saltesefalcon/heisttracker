<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heist Inventory Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .inventory-card {
      display: inline-block;
      margin: 10px;
      padding: 15px;
      border-radius: 10px;
      background-color: #f0f0f0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      width: 200px;
    }
    .log-entry { margin: 5px 0; padding: 5px; }
    .log-add { border-left: 5px solid green; background-color: #eaffea; }
    .log-remove { border-left: 5px solid red; background-color: #ffeaea; }
    .store-section { margin-top: 20px; }
    details summary { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Heist Inventory Tracker</h1>

  <h2>Current Inventory</h2>
  <div id="inventoryDisplay"></div>

  <h2>Add Inventory</h2>
  <input type="date" id="addDate" />
  <select id="addLocation">
    <option value="store1">Tulia</option>
    <option value="store2">Prohibition</option>
    <option value="store3">Beacon</option>
    <option value="store4">Ce Soir</option>
  </select>
  <select id="addProduct">
    <option value="Chardonnay">Chardonnay</option>
    <option value="Rosé">Rosé</option>
  </select>
  <input type="number" id="addAmount" placeholder="Cases to add" />
  <button onclick="updateInventory('add')">Add</button>

  <h2>Remove Inventory</h2>
  <input type="date" id="removeDate" />
  <select id="removeLocation">
    <option value="store1">Tulia</option>
    <option value="store2">Prohibition</option>
    <option value="store3">Beacon</option>
    <option value="store4">Ce Soir</option>
  </select>
  <select id="removeProduct">
    <option value="Chardonnay">Chardonnay</option>
    <option value="Rosé">Rosé</option>
  </select>
  <input type="number" id="removeAmount" placeholder="Cases to remove" />
  <button onclick="updateInventory('remove')">Remove</button>

  <h2>Inventory Logs by Location</h2>
  <div id="logsDisplay"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2Xz4JjOQqqTzKJGPn0NVmMC8j6G7Lj8I",
      authDomain: "heist-inventory-tracker.firebaseapp.com",
      databaseURL: "https://heist-inventory-tracker-default-rtdb.firebaseio.com",
      projectId: "heist-inventory-tracker",
      storageBucket: "heist-inventory-tracker.appspot.com",
      messagingSenderId: "290748860726",
      appId: "1:290748860726:web:f1782ae61f11833f3cbd40"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const locationNames = {
      store1: "Tulia",
      store2: "Prohibition",
      store3: "Beacon",
      store4: "Ce Soir"
    };

    async function fetchData() {
      const snapshot = await get(ref(db));
      if (!snapshot.exists()) return;
      const data = snapshot.val();
      displayInventory(data.inventory || {});
      displayLogs(data.logs || {});
    }

    function displayInventory(inventoryData) {
      const container = document.getElementById("inventoryDisplay");
      container.innerHTML = "";
      for (const location in inventoryData) {
        const store = inventoryData[location];
        const card = document.createElement("div");
        card.className = "inventory-card";
        card.innerHTML = `<strong>${locationNames[location] || location}</strong><br>
                          Chardonnay: ${store.Chardonnay || 0}<br>
                          Rosé: ${store["Rosé"] || 0}`;
        container.appendChild(card);
      }
    }

    function displayLogs(logsData) {
      const container = document.getElementById("logsDisplay");
      container.innerHTML = "";
      for (const location in logsData) {
        const section = document.createElement("div");
        section.className = "store-section";
        const details = document.createElement("details");
        details.open = true;
        const summary = document.createElement("summary");
        summary.textContent = locationNames[location] || location;
        details.appendChild(summary);

        const dates = Object.keys(logsData[location]).sort().reverse();
        for (const date of dates) {
          const entryDiv = document.createElement("div");
          entryDiv.innerHTML = `<strong>${date}</strong><br>`;
          for (const log of logsData[location][date]) {
            const logEl = document.createElement("div");
            logEl.className = `log-entry log-${log.type}`;
            logEl.innerHTML = `${log.type.toUpperCase()} ${log.amount} ${log.product}<br>Total: ${log.total}`;
            entryDiv.appendChild(logEl);
          }
          details.appendChild(entryDiv);
        }
        section.appendChild(details);
        container.appendChild(section);
      }
    }

    async function updateInventory(action) {
      const date = document.getElementById(`${action}Date`).value;
      const location = document.getElementById(`${action}Location`).value;
      const product = document.getElementById(`${action}Product`).value;
      const amount = parseInt(document.getElementById(`${action}Amount`).value);
      if (!date || !location || !product || isNaN(amount)) return;

      const snapshot = await get(ref(db));
      const data = snapshot.exists() ? snapshot.val() : { inventory: {}, logs: {} };

      if (!data.inventory[location]) data.inventory[location] = {};
      if (!data.inventory[location][product]) data.inventory[location][product] = 0;

      if (action === "add") {
        data.inventory[location][product] += amount;
      } else {
        data.inventory[location][product] = Math.max(0, data.inventory[location][product] - amount);
      }

      if (!data.logs[location]) data.logs[location] = {};
      if (!data.logs[location][date]) data.logs[location][date] = [];

      data.logs[location][date].push({
        type: action,
        product,
        amount,
        total: data.inventory[location][product]
      });

      await set(ref(db), data);
      fetchData();
    }

    fetchData();
  </script>
</body>
</html>
